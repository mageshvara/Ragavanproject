<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<form runat="server" action="/update" method="POST">
  <input type='file' id="imgInp" />
  <img  id="blah" src="#" alt="your image" />
  <input type="text" id="url" name="url" >
  <button type="submit" >Update</button>
</form>
<script>
    function getDataUrl(img) {
   // Create canvas
   const canvas = document.createElement('canvas');
   const ctx = canvas.getContext('2d');
   // Set width and height
   canvas.width = img.width;
   canvas.height = img.height;
   // Draw the image
   ctx.drawImage(img, 0, 0);
   return canvas.toDataURL('image/jpeg');
}
// Select the image



    function readURL(input) {
  if (input.files && input.files[0]) {
    var reader = new FileReader();
    
    reader.onload = function(e) {
      $('#blah').attr('src', e.target.result);
    }
    reader.readAsDataURL(input.files[0]); // convert to base64 string
  }
}

$("#imgInp").change(function() {
  readURL(this);
  const img = document.querySelector('#blah');
img.addEventListener('load', function (event) {
   const dataUrl = getDataUrl(event.currentTarget);
   document.getElementById("url").value=dataUrl;
});
});
</script>
</body>
</html>